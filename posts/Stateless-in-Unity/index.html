<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Stateless in Unity" /><meta property="og:locale" content="en" /><meta name="description" content="Prerequisites Familiar with state pattern Hands on events Hands on generics" /><meta property="og:description" content="Prerequisites Familiar with state pattern Hands on events Hands on generics" /><link rel="canonical" href="https://gbrosgames.github.io/posts/Stateless-in-Unity/" /><meta property="og:url" content="https://gbrosgames.github.io/posts/Stateless-in-Unity/" /><meta property="og:site_name" content="Gbros Games" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-09T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Stateless in Unity" /><meta name="twitter:site" content="@GbrosGames" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Stateless in Unity","dateModified":"2022-02-21T18:31:29+01:00","datePublished":"2021-02-09T00:00:00+01:00","description":"Prerequisites Familiar with state pattern Hands on events Hands on generics","url":"https://gbrosgames.github.io/posts/Stateless-in-Unity/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://gbrosgames.github.io/posts/Stateless-in-Unity/"},"@context":"https://schema.org"}</script><title>Stateless in Unity | Gbros Games</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Gbros Games"><meta name="application-name" content="Gbros Games"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/74556819?s=400&u=a8b8dd8c2c4849ea105dae6b2b92c79b617e1ad1&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Gbros Games</a></div><div class="site-subtitle font-italic">We are small indie game studio. Follow our adventures through the world of game industry</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/GbrosGames" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/GbrosGames" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gbros.games.studio','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.instagram.com/gbrosgames/" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Stateless in Unity</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Stateless in Unity</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/GbrosGames">Gbros Games</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-02-09 00:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Tue, Feb 9, 2021, 12:00 AM +0100" >Feb 9, 2021</em> </span> <span> Updated <em class="timeago" date="2022-02-21 18:31:29 +0100 " data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 21, 2022, 6:31 PM +0100" >Feb 21, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1466 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h2 id="prerequisites">Prerequisites<a href="#prerequisites" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>Familiar with state pattern<li>Hands on events<li>Hands on generics</ul><h2 id="introduction">Introduction<a href="#introduction" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>We were looking for lightweight solution for managing state of entities in Unity. We placed our bet on Stateless.NET library that we used previously during development of .NET Applications. It’s a nice and lightweight library under <a href="https://tldrlegal.com/license/apache-license-2.0-%28apache-2.0%29">Apache 2.0 License</a>.</p><h2 id="why-stateless">Why stateless?<a href="#why-stateless" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>Flexible<li>Lightweight<li>Hierarchical States<li>Possibility to reenter the state<li>Entry/Exit and Activation events<li>Guard clauses — for easy rules definition<li>Graph preview<li>Easy to read and maintain</ul><h2 id="unity-installation">Unity Installation<a href="#unity-installation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Open NuGet package manager and search for <a href="https://github.com/dotnet-state-machine/stateless">Stateless</a></p><p><img data-src="/assets/img/posts/stateless/01.webp" data-proofer-ignore></p><p>After installation, copy Stateless.dll and Stateless.xml from YourProject\Packages\Stateless.5.1.2\lib\netstandard2.0</p><p><img data-src="/assets/img/posts/stateless/02.webp" data-proofer-ignore></p><p>Create folder for external, non-unity packages in Assets directory. It may be something like</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>\Assets\Libraries\Stateless\
</pre></table></code></div></div><p>and paste files there.</p><p>Now we are ready to go! :)</p><h2 id="how-to-use">How To Use<a href="#how-to-use" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s create our Chest class and define our Trigger and State types:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Chest</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="k">enum</span> <span class="n">State</span> <span class="p">{</span> <span class="n">Opened</span><span class="p">,</span> <span class="n">Closed</span> <span class="p">}</span>
	<span class="k">public</span> <span class="k">enum</span> <span class="n">Trigger</span> <span class="p">{</span> <span class="n">Open</span><span class="p">,</span> <span class="n">Close</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure><p>Basic approach is to define representation of State as Enums, but thanks to generic types it can be everything, even MonoBehaviours.</p><p>It’s also good to define states and triggers directly in the class so we will avoid possibility of name duplication while creating our state machines. After that we can create our StateMachine. Let’s do it in Awake method.</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="n">StateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Trigger</span><span class="p">&gt;</span> <span class="n">stateMachine</span><span class="p">;</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">stateMachine</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Trigger</span><span class="p">&gt;(</span><span class="n">State</span><span class="p">.</span><span class="n">Closed</span><span class="p">);</span>

	<span class="n">stateMachine</span>
		<span class="p">.</span><span class="nf">Configure</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Opened</span><span class="p">)</span>
		<span class="p">.</span><span class="nf">OnEntry</span><span class="p">(</span><span class="n">OnChestOpened</span><span class="p">)</span>
		<span class="p">.</span><span class="nf">Permit</span><span class="p">(</span><span class="n">Trigger</span><span class="p">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">Closed</span><span class="p">);</span>

	<span class="n">stateMachine</span>
		<span class="p">.</span><span class="nf">Configure</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
		<span class="p">.</span><span class="nf">OnEntry</span><span class="p">(</span><span class="n">OnChestClosed</span><span class="p">)</span>
		<span class="p">.</span><span class="nf">Permit</span><span class="p">(</span><span class="n">Trigger</span><span class="p">.</span><span class="n">Open</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">Opened</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure><p>We have to call Configure method on every state to set up rules and relations between our states. After that we can define what actions can be performed during each state. Most common methods used during configuration for state machines are:</p><ul><li>OnEntry / OnExit — accepts Action which will be triggered on state enter / exit<li>OnEntryFrom — accepts Action which we want to perform after a transition from a certain state<li>Permit — the main method where we specify a valid state transition based on a trigger<li>PermitIf — as above with so called Guard (boolean function)<li>SubstateOf — method which sets parent state</ul><p>Lets look at the following example, where we are configuring state Opened and we are permitting Trigger Close to be called, after which state machine will transition its state to Closed:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">stateMachine</span>
	<span class="p">.</span><span class="nf">Configure</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Opened</span><span class="p">)</span>
	<span class="p">.</span><span class="nf">Permit</span><span class="p">(</span><span class="n">Trigger</span><span class="p">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">Closed</span><span class="p">);</span></code></pre></figure><p>Next we will configure state Closed. This time with the use of PermitIf . It is almost the same as above Permit function, but with ability to set up the Guard Clause — which will act as a Rule that will tell us whether we can enter triggered state or not:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">stateMachine</span>
	<span class="p">.</span><span class="nf">Configure</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
	<span class="p">.</span><span class="nf">PermitIf</span><span class="p">(</span><span class="n">Trigger</span><span class="p">.</span><span class="n">Open</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">Opened</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">player</span><span class="p">.</span><span class="nf">HasEpicKeyInInventory</span><span class="p">());</span></code></pre></figure><p>Lastly lets use SubstateOf — method which allows us to define hierarchy of States. We will use it for locked state, and we will set it as a sub-state of state closed:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">stateMachine</span>
	<span class="p">.</span><span class="nf">Configure</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Locked</span><span class="p">)</span>
	<span class="p">.</span><span class="nf">SubstateOf</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span></code></pre></figure><p>To check in which sate our machine currently is, we can call IsInState method. But this check also honours state hierarchy. So if our state machine would be in State.Locked and we would do check for State.Closed</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">stateMachine</span><span class="p">.</span><span class="nf">IsInState</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Closed</span><span class="p">);</span></code></pre></figure><p>the answer would be true.</p><p>Ok now lets see how we can harness benefits of using state machines! But first lets summarize what we did and what it gives us:</p><ul><li>We have created state machine for our Chest<li>We have described that at any time Chest enters the state Opened the OnChestOpened action will be invoked<li>We have also permitted our Trigger.Close to happen with destination state of Closed</ul><p>As you can see we didn’t write a single if statement here. For everyone that loves “clean code” or “less code” approach its already huge benefit. Now let explore what potential advantages it gives us when we are constructing complicated state machines. First of all it minimizes conditional complexity and eliminating the need for if and switch statements.</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="nf">OnChestClosed</span><span class="p">()</span>
<span class="p">{</span>
	<span class="c1">// play close animation</span>
	<span class="c1">// play close sound</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">OnChestOpened</span><span class="p">()</span>
<span class="p">{</span>
	<span class="c1">// play open animation</span>
	<span class="c1">// play open sound</span>
<span class="p">}</span></code></pre></figure><p>Secondly we can easily, extend the API for our Chest class by exposing public methods with ability to trigger its state changing logic:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">void</span> <span class="nf">Open</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(!</span><span class="n">stateMachine</span><span class="p">.</span><span class="nf">CanFire</span><span class="p">(</span><span class="n">Trigger</span><span class="p">.</span><span class="n">Open</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
	<span class="n">stateMachine</span><span class="p">.</span><span class="nf">Fire</span><span class="p">(</span><span class="n">Trigger</span><span class="p">.</span><span class="n">Open</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">Close</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(!</span><span class="n">stateMachine</span><span class="p">.</span><span class="nf">CanFire</span><span class="p">(</span><span class="n">Trigger</span><span class="p">.</span><span class="n">Close</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
	<span class="n">stateMachine</span><span class="p">.</span><span class="nf">Fire</span><span class="p">(</span><span class="n">Trigger</span><span class="p">.</span><span class="n">Close</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure><p>Please note that before firing specific trigger, we are validating if we have a permission to fire this trigger from current state.</p><p>Firing a trigger that does not have an allowed transition associated with it will cause an exception to be thrown. To prevent that, simply register some default behaviour and override exception through OnUnhandledTrigger() method:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">stateMachine</span><span class="p">.</span><span class="nf">OnUnhandledTrigger</span><span class="p">((</span><span class="n">state</span><span class="p">,</span> <span class="n">trigger</span><span class="p">)</span> <span class="p">=&gt;</span> 
<span class="p">{</span> 
	<span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Unhandled trigger </span><span class="p">{</span><span class="n">trigger</span><span class="p">}</span><span class="s"> can't befired from state </span><span class="p">{</span><span class="n">state</span><span class="p">}</span><span class="s">"</span><span class="p">);</span> 
<span class="p">});</span></code></pre></figure><p>Last thing that is really great about stateless is that your state machine can be visualized as a graph. Be sure to check Samples section below to learn more and get info where to find some code examples!</p><h2 id="graph-preview">Graph Preview<a href="#graph-preview" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The big advantage of using Stateless .NET is that you can easily visualize your state machine. To serialize your state machine to standard text-based <a href="https://en.wikipedia.org/wiki/DOT_%28graph_description_language%29">DOT</a> format, you have to call stateMachine GetInfo() method:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">graphVisualization</span> <span class="p">=</span> <span class="n">UmlDotGraph</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="n">stateMachine</span><span class="p">.</span><span class="nf">GetInfo</span><span class="p">());</span></code></pre></figure><p>Copy graphVisualization variable value and paste it on the <a href="http://www.webgraphviz.com/">here</a> — to see how the graph looks like. Obviously, if someone deems it necessary, this can be easily incorporated into unity through the custom editor script.</p><h2 id="unity-code-samples">Unity Code Samples<a href="#unity-code-samples" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>All code samples can be found on our GitHub <a href="https://github.com/GbrosGames/Tools/tree/main/Assets/Stateless">page</a></p><h3 id="example-1--chest"><a href="https://github.com/GbrosGames/Tools/blob/main/Assets/Stateless/Samples~/Example%201/Chest.cs">Example 1</a> — Chest<a href="#example-1--chest" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>The chest example with Key Code enum as a trigger. It works like a toggle. Whenever we press a Space bar the chest will open if it’s closed or will close if it’s opened. It’s the most simplistic example that shows us base usage of Stateless library.</p><h3 id="example-2--chest"><a href="https://github.com/GbrosGames/Tools/blob/main/Assets/Stateless/Samples~/Example%202/Chest.cs">Example 2</a> — Chest<a href="#example-2--chest" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>In this example we take whole idea from Example 1 a step further and we add custom trigger to open and close our chest. It’s good practice to nest State and Trigger inside the subject class, so we can avoid the name conflicts in case of multiple states and triggers are present in our project. We can refer to Chest state or trigger enum by calling it Chest.State / Chest.Trigger.</p><h3 id="example-3--chest"><a href="https://github.com/GbrosGames/Tools/blob/main/Assets/Stateless/Samples~/Example%203/Chest.cs">Example 3</a> — Chest<a href="#example-3--chest" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>In this example we will learn how to improve our code even further. We’ve exposed the public events that are triggered whenever the chest is open or closed. By doing that we have decoupled our animations from the Chest class itself. We’ve created the ChestAnimation component which is responsible just for playing animations. We do it cause It’s not the Chest component responsibility to do all of those things. Another key take-away — it’s good to subscribe to events in OnEnable / OnDisable methods:</p><figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="nf">OnEnable</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">chest</span><span class="p">.</span><span class="n">ChestClosed</span> <span class="p">+=</span> <span class="n">OnChestClosed</span><span class="p">;</span>
	<span class="n">chest</span><span class="p">.</span><span class="n">ChestOpened</span> <span class="p">+=</span> <span class="n">OnChestOpened</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">OnDisable</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">chest</span><span class="p">.</span><span class="n">ChestClosed</span> <span class="p">-=</span> <span class="n">OnChestClosed</span><span class="p">;</span>
	<span class="n">chest</span><span class="p">.</span><span class="n">ChestOpened</span> <span class="p">-=</span> <span class="n">OnChestOpened</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure><p>Now we have fully modular solution. We can add another component like ChestSound, ChestParticles, ChestReward etc.</p><h3 id="example-4--interactables--just-to-show-what-can-be-done-better"><a href="https://github.com/GbrosGames/Tools/blob/main/Assets/Stateless/Samples~/Example%204">Example 4</a> — Interactables — just to show what can be done better<a href="#example-4--interactables--just-to-show-what-can-be-done-better" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>In this example we have added simple Player and two chests with overlapping areas. We have removed Update method, which was listening for input, from Chest — because it’s not the Chest responsibility to manage user input. Instead of this, we’ve created Input Monitor with only one job: to gather user input. With this approach we can easily connect or replace this input system to a different one.</p><p>We’ve also added Interaction Monitor. It is registering every Interactables that can be interacted with whenever Player enters an interaction area. We have also created IInteractable interface and we extended Chest API by implementing it.</p><p>With this approach we are able to extend our system with ease. For example we can implement interface IInteractable in other places like Loot, Levers, Doors, and our Interaction Monitor will pick those up and handle all the communication between those components.</p><h2 id="good-practices">Good Practices<a href="#good-practices" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Lastly, lets make notes around few good practices that are worth mentioning here:</p><ul><li>Nest enum States and Triggers inside the subject class to avoid name conflicts in your solution<li>If you are creating states as separated classes, pass stateMachine Controller class to the constructor<li>Subscribe to events inside OnEnable method, and unsubscribe them in OnDisable</ul><h2 id="where-to-go-from-here">Where To Go From Here<a href="#where-to-go-from-here" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>In the incoming blog posts we will like to share more techniques, that we’ve found useful, while working with reactive state machines in our projects. We really hope that more developers can take benefit from using state machines and incorporate them into their toolbox.</p><p>All related scripts (and more!) can be found in our examples <a href="https://github.com/GbrosGames/Tools?path=Assets/Stateless">repository</a>, so please give it a try!</p><p>Finally If you want to do more reading check resources section!</p><h2 id="resources">Resources<a href="#resources" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><a href="https://github.com/dotnet-state-machine/stateless">Official Stateless Repository</a><br /> <a href="https://www.hanselman.com/blog/stateless-30-a-state-machine-library-for-net-core">Really good introduction to Stateless library by S. Henselman</a><br /> <a href="https://deviq.com/design-patterns/state-design-pattern">Great read about state pattern</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/unity/'>Unity</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/unity/" class="post-tag no-text-decoration" >Unity</a> <a href="/tags/intermediate/" class="post-tag no-text-decoration" >Intermediate</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Stateless in Unity - Gbros Games&url=https://gbrosgames.github.io/posts/Stateless-in-Unity/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Stateless in Unity - Gbros Games&u=https://gbrosgames.github.io/posts/Stateless-in-Unity/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Stateless in Unity - Gbros Games&url=https://gbrosgames.github.io/posts/Stateless-in-Unity/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Leveraging-SerializeReference-for-Flexible-Commands-in-Unity-Game-Development/">Leveraging SerializeReference for Flexible Commands in Unity Game Development</a><li><a href="/posts/Watchers/">Watchers</a><li><a href="/posts/Stateless-in-Unity/">Stateless in Unity</a><li><a href="/posts/UniRx-Series-Part-1-MessageBroker/">UniRx Series — [Part 1] — MessageBroker</a><li><a href="/posts/UniRx-PowerObservables/">UniRx — PowerObservables</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/intermediate/">Intermediate</a> <a class="post-tag" href="/tags/unity/">Unity</a> <a class="post-tag" href="/tags/unirx/">UniRx</a> <a class="post-tag" href="/tags/advanced/">Advanced</a> <a class="post-tag" href="/tags/beginner/">Beginner</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/UniRx-Series-Part-1-MessageBroker/"><div class="card-body"> <em class="timeago small" date="2021-03-06 00:00:00 +0100" >Mar 6, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>UniRx Series — [Part 1] — MessageBroker</h3><div class="text-muted small"><p> This series will be highly related to UniRx library Prerequisites Familiar with Observer pattern Hands on any Rx library Introduction MessageBroker is an in-memory publish/subscribe messa...</p></div></div></a></div><div class="card"> <a href="/posts/UniRx-PowerObservables/"><div class="card-body"> <em class="timeago small" date="2021-07-21 00:00:00 +0200" >Jul 21, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>UniRx — PowerObservables</h3><div class="text-muted small"><p> Prerequisites Familiar with Observer pattern Hands on any Rx library Introduction PowerObservables are set of time-based operations with ability to pause and possibility to manage tick fre...</p></div></div></a></div><div class="card"> <a href="/posts/Watchers/"><div class="card-body"> <em class="timeago small" date="2022-06-11 00:00:00 +0200" >Jun 11, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Watchers</h3><div class="text-muted small"><p> Introduction Have you ever struggled with jumping from tab to tab, from window to window? Are you tired of the endless journey through the object hierarchy to find the right one? Are you tired of...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="/posts/UniRx-Series-Part-1-MessageBroker/" class="btn btn-outline-primary" prompt="Newer"><p>UniRx Series — [Part 1] — MessageBroker</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/GbrosGames">Gbros Games</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/intermediate/">Intermediate</a> <a class="post-tag" href="/tags/unity/">Unity</a> <a class="post-tag" href="/tags/unirx/">UniRx</a> <a class="post-tag" href="/tags/advanced/">Advanced</a> <a class="post-tag" href="/tags/beginner/">Beginner</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-35F6LPD7RF"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-35F6LPD7RF'); }); </script>
